<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/static/output.css" rel="stylesheet">
    <title>Guess-IT</title>
</head>
<body class="bg-gray-600 text-white">
    <div class="flex flex-row items-center justify-between">
        <!--Historia przeciwnika - lewy -->
        <div id="left" class="left flex flex-col justify-start text-center pt-5 w-1/4 bg-gray-700 text-2xl">
                <div>
                    Historia wyborow przeciwnika:
                </div>
        </div>
        <!--Gra - środek -->
        <div class="flex flex-col justify-center items-center h-screen">
            <div class="text-9xl name spacing">
                GUESS-IT
            </div>
            <div id="Player" class="text-6xl" ></div>
            <div id="waitingScreen" class=" text-9x place-content-center" style="display: none;">
                Oczekiwanie na przeciwnika...
            </div>
            <div id="inputArea1" class="grid gap-2" style="display: none;" >
                <h2 class="text-center">Podaj swoja 5-cyfrowa liczbe</h2>
                <input type="text" id="number" maxlength="5" minlength="5" class="mb-2 border-2 border-gray-800 text-black">
                <button id="submitNumber" class="mt-2 bg-gray-700  text-gray-700">000</button>
            </div>
            <div id="inputArea2" class="grid gap-2" style="display: none;" >
                <h2 class="text-center">Podaj swoja 5-cyfrowa liczbe</h2>
                <input type="text" id="guess" maxlength="5" minlength="5" class="mb-2 border-2 border-gray-800 text-black">
                <button id="submitGuess" class="mt-2 bg-gray-700  text-gray-700">000</button>
            </div>
            <div id="guesses" class="flex flex-col justify-around w-full items-center text-3xl">
            </div>

            <ul id="messages"></ul>
            <div id = "playerNumber" class = "text-2xl flex justify-center"></div>
        </div>
        <!--Historia gracza - prawy -->
        <div class="flex flex-col justify-start text-center pt-5  w-1/4 bg-gray-700 right text-2xl">
            Historia twoich wyborow:
            <div id ="guesses_history" class="flex flex-col justify-around w-full items-center text-xl ">

            </div>
        </div>
    </div>

    <script>
        let x = 0;
        let current_Guess = 0;
        let y = 0;
        // Połączenie z WebSocket
        const ws = new WebSocket("ws://localhost:8000/ws");

        // Po otwarciu połączenia
        ws.onopen = function() {
            document.getElementById("inputArea1").style.display = "block";
        };

        // Odbieranie wiadomości z serwera
        ws.onmessage = function(event) {
            const messages = document.getElementById("messages");
            const messageText = event.data;
            const li = document.createElement("li");
            li.appendChild(document.createTextNode(messageText));
            processMessage(messageText, messages, li);
            if(x !== 0)
            {
                document.getElementById("inputArea2").style.display = "block";
                document.getElementById("messages").style.display = "block";
                document.getElementById("waitingScreen").style.display = "none";
            }
            else
            {
                x++;
            }


        };

        // Event listener dla przycisku wysłania liczby
        document.getElementById("submitNumber").addEventListener("click", function() {
            const numberInput = document.getElementById("number");
            const number = numberInput.value;

            // Sprawdź, czy liczba jest 5-cyfrowa
            if (number.length === 5 && !isNaN(number)) {
                ws.send(number);  // Wyślij liczbę do serwera
                numberInput.value = "";  // Wyczyść pole po wysłaniu
                document.getElementById("inputArea1").style.display = "none";
                document.getElementById("messages").style.display = "none";
                document.getElementById("waitingScreen").style.display = "block";
                document.getElementById("playerNumber").textContent = "Twoja liczba: " + number;

            } else {
                alert("Wpisz liczbe 5-cyfrowa");
            }
        });

        // Event listener dla przycisku wysłania strzału
        document.getElementById("submitGuess").addEventListener("click", function() {
            const guessInput = document.getElementById("guess");
            const guess = guessInput.value;

            // Sprawdź, czy strzał jest 5-cyfrową liczbą
            if (guess.length === 5 && !isNaN(guess)) {
                ws.send(guess);  // Wyślij strzał do serwera
                guessInput.value = '';  // Wyczyść pole po wysłaniu
                document.getElementById("inputArea2").style.display = "none";
                document.getElementById("messages").style.display = "none";
                document.getElementById("waitingScreen").style.display = "block";

            } else {
                alert("Wpisz liczbe 5-cyfrowa");
            }
        });

        // Funkcja do przetwarzania wiadomości od serwera (np. wyświetlanie wyników)
        function processMessage(messageText, messages, li)
        {
            const guesses_history = document.getElementById("guesses_history");
            if (!isNaN(messageText)) {
                document.getElementById("Player").textContent = "GRACZ " + messageText;
            }
            else if (messageText.includes("Obaj"))
            {
                y = 0;
            }
            else if (messageText.includes("zgaduje"))
            {
                let number_from_text = messageText.slice(-5);
                const left_div = document.getElementById("left");
                const left_child = document.createElement("div")
                left_child.appendChild(document.createTextNode(number_from_text));
                left_div.appendChild(left_child);
            }
            else if (messageText.includes("znajduje")) {
                let guess;

                guess = document.getElementById("guess_history" + current_Guess);
                if (!guess) {
                    guess = document.createElement('div');
                    guess.id = "guess_history" + current_Guess;
                    guess.className = guess
                    guess.className = "guess_history"
                    guess.style.display = 'flex';
                    guess.style.justifyContent = 'space-around';
                    guesses_history.appendChild(guess);
                }

                if (y < 5) {
                    const number = document.createElement("div");
                    number.id = "number" + y;
                    number.className = "number_history";
                    number.textContent = messageText[0];

                    if (messageText.includes("znajduje sie na wlasciwej pozycji")) {
                        number.style.background = "rgba(0, 128, 0, 0.6)";
                    } else if (messageText.includes("znajduje sie, ale na zlej pozycji")) {
                        number.style.background = "rgba(255, 255, 0, 0.6)";
                    } else if (messageText.includes("nie znajduje sie")) {
                        number.style.background = "rgba(31,41,55,0.6)";
                    }
                    guess.appendChild(number);
                    y++;
                }
                if(y===5)
                {
                    y = 0;
                    current_Guess++;
                }
            }

            else if (messageText.includes("Spróbuj zgadnąć liczbę przeciwnika")) {
                // Gra kontynuuje, poproś o kolejny strzał
                document.getElementById("guess").disabled = false;
            } else if (messageText.includes("Wygrał") || messageText.includes("REMIS")) {
                // Koniec gry
                document.getElementById("inputArea2").style.display = "none";
            }
        }
    </script>
</body>
</html>
